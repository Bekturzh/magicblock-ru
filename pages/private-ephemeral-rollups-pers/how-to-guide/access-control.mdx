---
title: "Управление доступом"
description: "Узнайте, как управлять детализированным контролем доступа и правами участников в Private Ephemeral Rollups (PER)."
---

import CreatePermissionWeb3js from "/snippets/acl-code/permission/web3js/create.mdx";
import UpdatePermissionWeb3js from "/snippets/acl-code/permission/web3js/update.mdx";
import DelegatePermissionWeb3js from "/snippets/acl-code/permission/web3js/delegate.mdx";
import CommitAndUndelegatePermissionWeb3js from "/snippets/acl-code/permission/web3js/commit_and_undelegate.mdx";
import ClosePermissionWeb3js from "/snippets/acl-code/permission/web3js/close.mdx";

import CreatePermissionKit from "/snippets/acl-code/permission/kit/create.mdx";
import UpdatePermissionKit from "/snippets/acl-code/permission/kit/update.mdx";
import DelegatePermissionKit from "/snippets/acl-code/permission/kit/delegate.mdx";
import CommitAndUndelegatePermissionKit from "/snippets/acl-code/permission/kit/commit_and_undelegate.mdx";
import ClosePermissionKit from "/snippets/acl-code/permission/kit/close.mdx";

import CreatePermissionPinocchio from "/snippets/acl-code/permission/pinocchio/create.mdx";
import UpdatePermissionPinocchio from "/snippets/acl-code/permission/pinocchio/update.mdx";
import DelegatePermissionPinocchio from "/snippets/acl-code/permission/pinocchio/delegate.mdx";
import CommitAndUndelegatePermissionPinocchio from "/snippets/acl-code/permission/pinocchio/commit_and_undelegate.mdx";
import ClosePermissionPinocchio from "/snippets/acl-code/permission/pinocchio/close.mdx";

import MemberFlagsRust from "/snippets/acl-code/member/rust.mdx";
import MemberFlagsWeb3js from "/snippets/acl-code/member/web3js.mdx";
import MemberFlagsKit from "/snippets/acl-code/member/kit.mdx";
import MemberFlagsPinocchio from "/snippets/acl-code/member/pinocchio.mdx";

import AuthorizationWeb3js from "/snippets/acl-code/authorization/web3js.mdx";
import AuthorizationKit from "/snippets/acl-code/authorization/kit.mdx";

import PerCards from "/snippets/per-cards.mdx";
import AclCards from "/snippets/acl-cards.mdx";
import PerEndpoint from "/snippets/per-endpoint.mdx";
import Validators from "/snippets/validators.mdx";

---

<Columns cols={2}>
  <Card title="Программа разрешений" icon="github">
    Управление разрешениями на блокчейне (Скоро!)
  </Card>
  <Card title="SDK для Ephemeral Rollups" icon="github" href="https://github.com/magicblock-labs/ephemeral-rollups-sdk">
    SDK для Private Ephemeral Rollups (PER)
  </Card>
</Columns>

---

## **Обзор**

Приватные Эфемер Роллапы — это Эфемер Роллапы  которые обеспечивают детализированный контроль доступа к аккаунтам с ограниченными правами в среде Trusted Execution Environment (TEE) с соблюдением требований комплаенса. Каждый аккаунт с разрешениями хранит список участников с конкретными флагами, определяющими, какие действия они могут выполнять.

**Ключевые концепции**

- **Permission Account:** PDA, который хранит правила контроля доступа для конкретного аккаунта
- **Members:** Адреса, которым предоставлены определённые права через флаги
- **Flags:** Битовые маски, определяющие, что может делать участник (управление, просмотр логов, балансов и т.д.)
- **Public Permissions:** Если для участников установлено значение None, аккаунт с ограниченным доступом становится временно видимым

**Флаги участников**

Флаги участников определяют детализированные права каждого участника. Флаги можно комбинировать с помощью побитового OR, чтобы предоставить несколько прав одновременно.

**Описание флагов:**

- **AUTHORITY:** Позволяет участнику обновлять и делегировать настройки разрешений, добавлять/удалять других участников и изменять их флаги
- **TX_LOGS:** Позволяет участнику просматривать логи выполнения транзакций
- **TX_BALANCES:** Позволяет участнику видеть изменения баланса аккаунта
- **TX_MESSAGE:** Позволяет участнику просматривать данные сообщений транзакций
- **ACCOUNT_SIGNATURES:** Позволяет участнику просматривать подписи аккаунтов

<Tabs>
  <Tab title="Rust SDK">
    <MemberFlagsRust />
  </Tab>
  <Tab title="Pinocchio">
    <MemberFlagsPinocchio />
  </Tab>
  <Tab title="Web3.js">
    <MemberFlagsWeb3js />
  </Tab>
  <Tab title="Kit">
    <MemberFlagsKit />
  </Tab>
</Tabs>

---

## Жизненный цикл разрешений

Типичный жизненный цикл аккаунта с разрешениями требует взаимодействия с Permission Program от MagicBlock `ACLseoPoyC3cBqoUtkbjZ4aDrkurZW86v19pXz2XQnp1` и Delegation Program `DELeGGvXpWV2fqJUhqcF5ZSYMS4JTLjteaAMARRSaeSh`:

<Steps>
  <Step title={<a href="#1-create">Create Permission</a>}>
    Инициализируйте новый аккаунт с разрешениями с начальными участниками и их флагами.
  </Step>
  <Step title={<a href="#2-delegate">Delegate Permission</a>}>
    Делегируйте разрешение в Приватном Эфемер Роллапе для обеспечения его применения и управления доступом в реальном времени.

    <Validators />
  </Step>
  <Step title={<a href="#3-update">Update Permission</a>}>
    Добавляйте, удаляйте или изменяйте разрешения участников по необходимости. Обновления можно выполнять в реальном времени на Приватном Эфемер Роллапе
  </Step>
  <Step title={<a href="#4-request">Make Request</a>}>
    Перед выполнением запросов проверьте целостность TEE RPC и получите токен авторизации. Доступ к состоянию аккаунта или его изменение имеют только участники с соответствующими флагами.
  </Step>
  <Step title={<a href="#5-commit--undelegate">Commit and Undelegate</a>}>
    Синхронизируйте окончательное состояние обратно на Solana и передайте аккаунт под контроль базового слоя.
  </Step>
  <Step title={<a href="#6-close">Close Permission</a>}>
    Закройте аккаунт с разрешениями и верните его лампорты, когда он больше не нужен.
  </Step>
</Steps>

---

## Операции с разрешениями

<Tabs>
  <Tab title="1. Создать">
    **После того как вы создали программу, вы можете добавить хуки разрешений и делегирования для управления доступом к вашим аккаунтам. Например, см. Быстрый старт .**

    Создайте новый аккаунт с разрешениями с начальными участниками и их флагами через Permission Program от MagicBlock `ACLseoPoyC3cBqoUtkbjZ4aDrkurZW86v19pXz2XQnp1`.

    <Tabs>
      <Tab title="Rust SDK">
        <CreatePermissionRust />
      </Tab>
      <Tab title="Pinocchio">
        <CreatePermissionPinocchio />
      </Tab>
      <Tab title="Kit">
        <CreatePermissionKit />
      </Tab>
      <Tab title="Web3.js">
        <CreatePermissionWeb3js />
      </Tab>
    </Tabs>
    **Сценарии использования:**

    - Инициализация контроля доступа для нового делегированного аккаунта
    - Настройка участников с полномочиями и их разрешений
    - Определение, кто может просматривать детали транзакций

    [⬆️ Вернуться к началу](#permission-lifecycle)
  </Tab>
  <Tab title="2. Делегейт">
    ****`Делегируйте аккаунт с разрешениями для обеспечения выполнения с низкой задержкой на Private Ephemeral Rollup через Delegation Program от MagicBlock DELeGGvXpWV2fqJUhqcF5ZSYMS4JTLjteaAMARRSaeSh.`****

    <Validators />

    <Tabs>
      <Tab title="Rust SDK">
        <DelegatePermissionRust />
      </Tab>
      <Tab title="Pinocchio">
        <DelegatePermissionPinocchio />
      </Tab>
      <Tab title="Kit">
        <DelegatePermissionKit />
      </Tab>
      <Tab title="Web3.js">
        <DelegatePermissionWeb3js />
      </Tab>
    </Tabs>
    **Use Cases:**

    - Enable ER execution for a permissioned account
    - Designate a specific validator to execute state changes
    - Set up delegation for real-time transaction processing

    **Important:**

    - Either the authority or permissioned_account must sign based on AUTHORITY_FLAG
    - The validator processes transactions at ER speed
    - Commit frequency determines how often state syncs to Solana
    - **Once delegated to Private Ephemeral Rollup, the permission is enforced** - only members with appropriate flags can access or modify the account state

    [⬆️ Back to Top](#permission-lifecycle)
  </Tab>
  <Tab title="3. Обновить">
    ****`Изменяйте существующих участников или их флаги в аккаунте с разрешениями через Permission Program от MagicBlock ACLseoPoyC3cBqoUtkbjZ4aDrkurZW86v19pXz2XQnp1.`****

    <Tabs>
      <Tab title="Rust SDK">
        <UpdatePermissionRust />
      </Tab>
      <Tab title="Pinocchio">
        <UpdatePermissionPinocchio />
      </Tab>
      <Tab title="Kit">
        <UpdatePermissionKit />
      </Tab>
      <Tab title="Web3.js">
        <UpdatePermissionWeb3js />
      </Tab>
    </Tabs>
    **Use Cases:**

    - Add new members to a permission group
    - Revoke permissions by removing members
    - Change member flags to grant/restrict access
    - Set members to `None` to make account temporarily visible

    [⬆️ Back to Top](#permission-lifecycle)
  </Tab>
  <Tab title="4. Запрос">
    При обращении к Private Ephemeral Rollup необходимо сначала получить авторизацию:

    <PerEndpoint />

    **Authorization Steps:**

    1. **Verify TEE RPC Integrity**: Verify the TEE RPC server runs on genuine Intel TDX hardware using its TDX quote and Intel-issued attestation certificates
    2. **Request Authorization Token**: Sign a challenge message to receive an authorization token
    3. **Create Connection**: Pass the authorization token inside header or as query parameter

    <Tabs>
      <Tab title="Kit">
        <AuthorizationKit />
      </Tab>
      <Tab title="Web3.js">
        <AuthorizationWeb3js />
      </Tab>
    </Tabs>
    **Account Visibility:**

    - **By default**: All accounts are transparent and accessible to any authorized user
    - **With permissions**: Once an account is permissioned through the permission system, access control rules are enforced during every request
    - Only members with appropriate flags can access or modify permissioned accounts and transactions

    **Key Points:**

    - Requests are executed in real-time on the validator
    - Member flags determine what each user can do
    - Permissions can be updated dynamically during execution
    - Updates take effect immediately on the Private Ephemeral Rollup

    [⬆️ Back to Top](#permission-lifecycle)
  </Tab>
  <Tab title="5. Фиксация и отмена делегирования">
    Последнее состояние разрешений на Private Ephemeral Rollup обеспечивает контроль доступа. Для закрытия аккаунта с разрешениями обновите участников разрешений перед отменой делегирования на Solana.

    <Tabs>
      <Tab title="Rust SDK">
        <CommitAndUndelegatePermissionRust />
      </Tab>
      <Tab title="Pinocchio">
        <CommitAndUndelegatePermissionPinocchio />
      </Tab>
      <Tab title="Kit">
        <CommitAndUndelegatePermissionKit />
      </Tab>
      <Tab title="Web3.js">
        <CommitAndUndelegatePermissionWeb3js />
      </Tab>
    </Tabs>
    [⬆️ Back to Top](#permission-lifecycle)
  </Tab>
  <Tab title="6. Закрыть ">
    Закройте аккаунт с разрешениями и верните его лампорты на Solana.

    <Tabs>
      <Tab title="Rust SDK">
        <ClosePermissionRust />
      </Tab>
      <Tab title="Pinocchio">
        <ClosePermissionPinocchio />
      </Tab>
      <Tab title="Kit">
        <ClosePermissionKit />
      </Tab>
      <Tab title="Web3.js">
        <ClosePermissionWeb3js />
      </Tab>
    </Tabs>
    **Use Cases:**

    - Clean up unused permission accounts
    - Reclaim SOL from closed accounts

    **Important:**

    - The permission must be undelegated to Solana first
    - If delegated, call `commit_and_undelegate` before closing
    - Lamports are returned to the payer

    [⬆️ Back to Top](#permission-lifecycle)
  </Tab>
</Tabs>

---

## **Рекомендации по использованию**

- **Управление полномочиями (Authority Management):** Всегда назначайте **AUTHORITY_FLAG** хотя бы одному доверенному участнику
- **Минимальные привилегии (Least Privilege):** Предоставляйте каждому участнику только необходимые флаги
- **Обновления в реальном времени (Real-time Updates):** Разрешения можно обновлять в реальном времени на Private Ephemeral Rollup без отмены делегирования, что позволяет динамически управлять доступом
- **Очистка (Cleanup):** Отменяйте делегирование и закрывайте неиспользуемые аккаунты с разрешениями, чтобы освободить SOL

**Соображения по безопасности**

- **Проверка подписанта (Signer Validation):** Только участники с **AUTHORITY_FLAG** или программа с аккаунтом с разрешениями могут авторизовать изменения
- **Публичные аккаунты (Public Accounts):** Установка участников в None делает аккаунт публично видимым
- **Аудит доступа (Access Auditing):** Используйте флаги участников для аудита и контроля доступа

---

<Columns cols={2}>
  <Card title="Контроль доступа" icon="lock" iconType="duotone" href="/pages/private-ephemeral-rollups-pers/how-to-guide/access-control">
    Детализированный контроль доступа.
  </Card>
  <Card title="Конфиденциальность на блокчейне" icon="user-helmet-safety" iconType="duotone" href="/pages/private-ephemeral-rollups-pers/introduction/onchain-privacy">
    Механизмы и концепции обеспечения конфиденциальности
  </Card>
  <Card title="Авторизация" icon="key" iconType="duotone" href="/pages/private-ephemeral-rollups-pers/introduction/authorization">
    Система авторизации
  </Card>
  <Card title="Система соответствия требованиям" icon="solar-system" iconType="duotone" href="/pages/private-ephemeral-rollups-pers/introduction/compliance-framework">
    Стандарты и руководства по соблюдению требований
  </Card>
</Columns>