---
title: "Быстрый старт"
description: "Любая программа Solana может быть обновлена с помощью Эфемерных Роллапов путём добавления возможностей делегирования."
---

import Endpoints from "/snippets/endpoints.mdx";
import Validators from "/snippets/validators.mdx";
import Software from "/snippets/software.mdx";
import SolanaResources from "/snippets/solana-resources.mdx";

import WriteProgramCode from "/snippets/anchor-counter-code/write-program.mdx";
import DelegateCode from "/snippets/anchor-counter-code/delegate.mdx";
import CommitCode from "/snippets/anchor-counter-code/commit.mdx";
import UndelegateCode from "/snippets/anchor-counter-code/undelegate.mdx";
import TestCode from "/snippets/anchor-counter-code/test.mdx";
import ResizeCode from "/snippets/anchor-counter-code/resize.mdx";
import OncurveDelegation from "/snippets/oncurve-delegation.mdx";
import MagicRouterSDK from "/snippets/magic-router-sdk.mdx";
import DelegationInfo from "/snippets/delegation-info.mdx";
import MagicActionExample from "/snippets/magic-action-example.mdx";

import QuickAccesER from "/snippets/quick-access-er.mdx";
import QuickAccessERFooter from "/snippets/quick-access-er-footer.mdx";

### Быстрый доступ

Ознакомьтесь с основным примером счетчика:

<Columns cols={2}>
  <Card title="GitHub" icon="anchor" iconType="duotone" href="https://github.com/magicblock-labs/magicblock-engine-examples/tree/main/anchor-counter">
    Реализация Anchor
  </Card>
  <Card title="GitHub" icon="atom" iconType="thin" href="https://github.com/magicblock-labs/ephemeral-counter-ui">
    Реализация React
  </Card>
</Columns>

---

<div style={{ position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden" }}>
<iframe src="https://www.youtube.com/embed/qwu2RBKyFiw?si=PMg-3UbRfvvbrs7C&list=PLWR_ZQiGMS8mIe1kPZe8OfHIbhvZqaM8V" title="Build a real-time Anchor Counter on Solana with MagicBlock's Ephemeral Rollup | Tutorial" style={{ position:"absolute",top:0,left:0,width:"100%",height:"100%" }} frameBorder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowFullScreen referrerPolicy="strict-origin-when-cross-origin" />

</div>

---

## Пошаговое руководство

Создайте вашу программу и обновите её, добавив хуки делегирования с помощью Программы Делегирования MagicBlock. `DELeGGvXpWV2fqJUhqcF5ZSYMS4JTLjteaAMARRSaeSh`:

<Steps>
  <Step title={<a href="#1-write-program">Write your program</a>}>
    Напишите вашу программу для Solana так, как вы обычно это делаете.
  </Step>
  <Step title='
<a href="#2-delegate">
Add delegation and undelegation hooks in your program
</a>
'>
    Добавьте CPI-хуки для делегирования, фиксации и анделегирования аккаунтов состояния через сессии Эфемерного Роллапа.

    <Validators />
  </Step>
  <Step title={<a href="#3-deploy">Deploy your program on Solana.</a>}>
    Разверните вашу программу напрямую в Solana с помощью Anchor или Solana CLI
  </Step>
  <Step title='
<a href="#4-test">
Ready to execute transactions for delegation and real-time speed
</a>
'>
    Отправляйте транзакции как в блокчейн, так и вне его без изменений, при этом соблюдая спецификацию SVM RPC..
  </Step>
</Steps>

---

## Пример счетчика

<img
  src="/images/gifs/counter-420w.gif"
  alt="Counter GIF"
  style={{ width:"100%",maxWidth:"420px",height:"auto",objectFit:"contain",borderRadius:"8px" }}
/>

<Software />

### Фрагменты кода

<Tabs>
  <Tab title="1. Напиши программу">
    Программа реализует две основные инструкции:

    1. `initialize`: Устоновите счетчик на 0
    2. `increment`: Увеличивает счётчик на 1

    Программа реализует специальные инструкции для делегирования и отмены делегирования счётчика:

    1. `Delegate`: Делегирует счётчик с базового слоя (Base Layer) в ЭР (вызывается на базовом слое)
    2. `CommitAndUndelegate`: Планирует синхронизацию счётчика из ЭР в базовый слой (Base Layer) и отменяет делегирование счётчика в ЭР (вызывается в ЭР)
    3. `Commit`: Планирует синхронизацию счётчика из ER в базовый слой (Base Layer) (вызывается в ЭР)
    4. `Undelegate`:
       - Планирует синхронизацию и отмену делегирования счётчика (вызывается в ER)
       - Отмена делегирования, инициируемая через callback-инструкцию, внедрённую с помощью `#[ephemeral]` (вызывается на базовом слое (Base Layer) через CPI валидатора)

    <WriteProgramCode />

    Ничего особенного — это просто простой Anchor-программный контракт, который увеличивает счётчик. Единственное отличие в том, что мы добавляем макрос `ephemeral` для отмены делегирования и макрос `delegate`, чтобы внедрить полезную логику для взаимодействия с программой делегирования.

    [⬆️ Вернуться к началу](#code-snippets)
  </Tab>
  <Tab title="2. Делегировать ">
    <Validators />

    1. Добавьте `ephemeral-rollups-sdk` с возможностями Anchor в вашу программу

    ```bash
    cargo add ephemeral-rollups-sdk --features anchor
    ```

    Ипортировать `delegate`, `commit`, `ephemeral`, `DelegateConfig`, `commit_accounts` аа так же`commit_and_undelegate_accounts`:

    ```rust
    use ephemeral_rollups_sdk::anchor::{
      commit,
      delegate,
      ephemeral
    };
    use ephemeral_rollups_sdk::cpi::DelegateConfig;
    use ephemeral_rollups_sdk::ephem::{
      commit_accounts,
      commit_and_undelegate_accounts
      };
    ```

    2. Добавьте в вашу программу макрос `delegate` и инструкцию, макрос `ephemeral` и инструкцию `undelegate`. Укажите предпочитаемую конфигурацию делегирования, например, автоматические коммиты и конкретного валидатора ЭР

    <DelegateCode />

    <CommitCode />

    <UndelegateCode />

    <DelegationInfo />

    [⬆️ Вернуться к началу](#code-snippets)
  </Tab>
  <Tab title="3. Развернуть">
    Теперь ваша программа обновлена и готова! Скомпилируйте и разверните её в нужном кластере:

    ```bash
    anchor build && anchor deploy
    ```

    [⬆️ Вернуться к началу](#code-snippets)
  </Tab>
  <Tab title="4. Протестировать">
    Готово к выполнению транзакций для делегирования с поддержкой обработки в реальном времени

    <Validators />

    ```bash
    anchor test --skip-build --skip-deploy --skip-local-validator
    ```

    **Запустите следующий тест:**

    <TestCode />

    Чтобы упростить интеграцию через фронтенд, мы создали Magic Router. Вы отправляете транзакции напрямую в Magic Router, а мы определяем за вас, следует ли направлять их в Ephemeral Rollup или на базовый слой.

    <Endpoints />

    [⬆️ Вернуться к началу ](#code-snippets)
  </Tab>
</Tabs>

---

### Расширенные Фрагменты Кода

<Tabs>
  <Tab title="Изменить размер PDA">
    При изменении размера делегированного PDA:

    - У PDA должно быть достаточно лампортов, чтобы оставаться освобождённым от аренды для нового размера аккаунта.
    - Если требуется добавить дополнительные лампорты, счётчик-плательщик должен быть делегирован для предоставления недостающей суммы.
    - PDA должен принадлежать программе, а транзакция должна включать всех необходимых подписантов для перевода лампортов.
    - Используй `system_instruction::allocate`

    <ResizeCode />

    [⬆️ Вернутся к началу ](#advanced-code-snippets)

    ### Быстрый доступ

    Узнайте больше о приватных ER, нативной реализации на Rust и локальной разработке:
  </Tab>
</Tabs>

<Columns cols={2}>
  <Card title="Приватные эфемерные роллапы (PER)" icon="anchor" iconType="duotone" href="/pages/private-ephemeral-rollups-pers/how-to-guide/quickstart">
    Быстрый старт
  </Card>
  <Card title="Rust Native" icon="rust" href="/pages/ephemeral-rollups-ers/how-to-guide/rust-program">
    Быстрый старт
  </Card>
  <Card title="Руководство" icon="computer-speaker" iconType="duotone" href="/pages/ephemeral-rollups-ers/how-to-guide/local-development">
    Локальная разработка
  </Card>
</Columns>

---

---

<SolanaResources />

---

## Продукты MagicBlock

import ProductCards from "/snippets/product-cards.mdx";

<ProductCards />

---