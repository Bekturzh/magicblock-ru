---
title: "Программа для Solana "
description: "Узнайте, как написать простую программу на Rust, которая делегирует и увеличивает счётчик в Solana."
---

import DelegateCode from "/snippets/rust-counter-code/delegate.mdx";
import CommitCode from "/snippets/rust-counter-code/commit.mdx";
import UndelegateCode from "/snippets/rust-counter-code/undelegate.mdx";
import InstructionsCode from "/snippets/rust-counter-code/instructions.mdx";
import ResizeCode from "/snippets/rust-counter-code/resize.mdx";
import OncurveDelegation from "/snippets/oncurve-delegation.mdx";

import QuickAccesERRust from "/snippets/quick-access-er-rust.mdx";

---

### **Быстрый доступ**

Ознакомьтесь с базовым примером счётчика в других реализациях:

<Columns cols={2}>
  <Card title="GitHub" icon="github" href="https://github.com/magicblock-labs/magicblock-engine-examples/tree/main/rust-counter">
    Нативная реализация на Rust
  </Card>
  <Card title="GitHub" icon="GitHub" href="https://github.com/magicblock-labs/magicblock-engine-examples/tree/main/pinocchio-counter">
    Реализация на Pinocchio
  </Card>
  <Card title="Local Development" icon="computer" iconType="duotone" href="/pages/ephemeral-rollups-ers/how-to-guide/local-development">
    Локальная разработка
  </Card>
</Columns>

---

<div style={{ position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden" }}>
<iframe src="https://www.youtube.com/embed/b77bwSGDHK0?si=Oknc5f8CuC17WBnV&list=PLWR_ZQiGMS8mIe1kPZe8OfHIbhvZqaM8V" title="Build a real-time Rust Counter on Solana with MagicBlock's Ephemeral Rollup | Tutorial" style={{ position:"absolute",top:0,left:0,width:"100%",height:"100%" }} frameBorder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowFullScreen referrerPolicy="strict-origin-when-cross-origin" />

</div>

---

## **Пошаговое руководство**

Соберите вашу программу и обновите её с хуками делегирования с помощью Delegation Program от MagicBlock`DELeGGvXpWV2fqJUhqcF5ZSYMS4JTLjteaAMARRSaeSh`:

<Steps>
  <Step title={<a href="#2-delegate">Напишите программу и добавьте инструкции по делегированию</a>}>
    Пишите вашу программу на Solana так, как вы обычно это делаете.
  </Step>
  <Step title={<a href="#2-delegate">Delegate PDA on Base Layer</a>}>
    Добавьте CPI-хуки для делегирования, коммита и отмены делегирования аккаунтов состояния через сессии Эфимер Роллап

    <Info>
      Эти общедоступные средства проверки поддерживаются для разработки. Не забудьте добавить конкретный ER валидатор в свою инструкцию при делегировании:

      - Азия ([devnet-as.magicblock.app](http://devnet-as.magicblock.app)): `MAS1Dt9qreoRMQ14YQuhg8UTZMMzDdKhmkZMECCzk57`
      - Европа ([devnet-eu.magicblock.app](http://devnet-eu.magicblock.app)): `MEUGGrYPxKk17hCr7wpT6s8dtNokZj5U2L57vjYMS8e`
      - США ([devnet-us.magicblock.app](http://devnet-us.magicblock.app)): `MUS3hc9TCw4cGC12vHNoYcCGzJG1txjgQLZWVoeNHNd`
      - TEE ([tee.magicblock.app](http://tee.magicblock.app)): `FnE6VJT5QNZdedZPnCoLsARgBwoE6DeJNjBs2H1gySXA`
      - Локальная служба поддержки ([localhost](http://localhost)): `mAGicPQYBMvcYveUZA5F5UNNwyHvfYh5xkLS2Fr1mev`
    </Info>
  </Step>
  <Step title={<a href="#3-commit">Commit PDA on ER</a>}>
    Разверните вашу программу напрямую на Solana с помощью Solana CLI.
  </Step>
  <Step title={<a href="#4-undelegate">Undelegate PDA on ER</a>}>
    Отправляйте транзакции без изменений как в сети (on-chain), так и вне сети (off-chain), которые также соответствуют спецификации SVM RPC.
  </Step>
</Steps>

---

## Пример Счетчика

Могут потребоваться следующие пакеты программного обеспечения, другие версии также могут быть совместимы:

| **Программное обеспечение** | **Версия** | **Руководство по установке**                                                  |
| :-------------------------- | :--------- | :---------------------------------------------------------------------------- |
| **Solana**                  | 2.3.13     | [<u>Установить Solana</u>](https://docs.anza.xyz/cli/install)                 |
| **Rust**                    | 1.85.0     | [**<u>Установить Rust</u>**](https://rust-lang.org/tools/install/)            |
| **Anchor**                  | 0.32.1     | [**<u>Установить Anchor</u>**](https://www.anchor-lang.com/docs/installation) |
| \*\*Node \*\*               | 24.10.0    | [<u>Установить Node</u>](https://nodejs.org/en/download/current)              |

### Code Snippets

<Tabs>
  <Tab title="1. Напишите программу">
    **Программа реализует две основные инструкции:**

    - **InitializeCounter:** Инициализирует счётчик и устанавливает его в 0 (вызывается на базовом слое, Base Layer)
    - **IncreaseCounter:** Увеличивает инициализированный счётчик на X (вызывается на базовом слое или в ER)

      Программа реализует специальные инструкции для делегирования и отмены делегирования счётчика:
    - **Delegate:** Делегирует счётчик с базового слоя (Base Layer) в ER (вызывается на базовом слое)
    - **CommitAndUndelegate:** Планирует синхронизацию счётчика из ER в базовый слой и отменяет делегирование счётчика в ER (вызывается в ER)
    - **Commit:** Планирует синхронизацию счётчика из ER в базовый слой (вызывается в ER)
    - **Undelegate:** Отменяет делегирование счётчика на базовом слое (вызывается на базовом слое через CPI валидатора)

    Вот основная структура нашей программы:

    {" "}

    <InstructionsCode />

    <Note>
      Your "Undelegate" instruction must have the exact discriminator. It is never called by you, instead the validator on the Base Layer will callback with a CPI into your program after undelegating your account on ER.
    </Note>
    [⬆️ Вернуться к началу](#code-snippets)
  </Tab>
  <Tab title="2. Делегировать">
    ### Делегирование PDA счётчика

    Чтобы делегировать PDA счётчика и сделать его доступным для записи в сессии Ephemeral Rollup, нам нужно добавить инструкцию, которая внутри вызывает функцию `delegate_account`. Функция `delegate_account` выполнит CPI к программе делегирования, которая после проверки получит владение аккаунтом. После этого эпемерный валидатор сможет начать обработку транзакций на PDA счётчика и предлагать изменения состояния через программу делегирования.

    <Card title="Транзакция (базовый слой): Делегировать" icon="magnifying-glass" iconType="duotone" href="https://solscan.io/tx/5jUdf5rsfQsbLYAahS9axrnLnEjdbUqtXUmGfgGuS7QqbYJ4FZHgXTNoT1bxPXp7XQu78r8Ebpp1RT2u9V6qsc1r?cluster=devnet">
      Просмотрите детали транзакций в Solana Explorer
    </Card>
    <DelegateCode />

    [⬆️ Вернуться к началу](#code-snippets)
  </Tab>
  <Tab title="3. Коммит">
    ### Коммитинг, пока PDA делегирован

    Эфемерная среда выполнения позволяет зафиксировать состояние PDA, пока он делегирован. Это выполняется вызовом функции `commit_accounts`.

    <CardGroup cols={2}>
      <Card title="Транзакция (ЭР): Коммит" icon="magnifying-glass" iconType="duotone" href="https://solscan.io/tx/5GiFGyrnJPkEQbhE8EHVYczoj2RPGe1YSnoq1DzcUHAxpyzMUKtxG2Tc7TLkxtcCHr72ftnvmkAVMfecTaf6TCK8?cluster=custom&customUrl=https://devnet.magicblock.app">
        Просмотрите детали транзакции в Solana Explorer
      </Card>
      <Card title="Транзакция (базовый слой): Коммит" icon="magnifying-glass" iconType="duotone" href="https://solscan.io/tx/5fHBADq99LAEBzGoeDXGtN3ut8RBf2s5UhbDM1N6TMTpvADNeYLz8e8vinNWj1VhLhrR7UxFoW7bo2u6pBR3YRjj?cluster=devnet">
        Просмотр деталей транзакции в Solana Explorer
      </Card>
    </CardGroup>
    <CommitCode />

    [⬆️ Вернуться к началу](#code-snippets)
  </Tab>
  <Tab title="4. Отменить делегирование">
    ### Отмена делегирования PDA

    Отмена делегирования PDA выполняется вызовом функции `commit_and_undelegate_accounts` в рамках какой-либо инструкции. При отмене делегирования фиксируется последнее состояние и возвращается владение PDA программе-владельцу. После отмены делегирования и финализации состояния валидатор создаёт callback CPI в функцию `undelegate` на базовом слое (Base Layer).

    <CardGroup cols={2}>
      <Card title="Транзакция (ЭР): Отменить делегирование" icon="magnifying-glass" iconType="duotone" href="https://solscan.io/tx/bMN6AhXrGH93Uc6ALibGgjnE39hcnY57mBhYkZ8TRaKxNRvyFaweaQPBmDxPv81cgR47WTTzzhfziTUEgAT8Y5m?cluster=custom&customUrl=https://devnet.magicblock.app">
        Просмотрите детали транзакции в Solana Explorer
      </Card>
      <Card title="Транзакция (базовый слой): Отменить делегирование" icon="magnifying-glass" iconType="duotone" href="https://solscan.io/tx/8JafYWiXmd4CHc2E97WKYnaNPmChZeg8aGYY7UUWaQ7Z54N5WoMcAVivyv2vdn9wKirMkR3y4UcmFPdXYqBtKAa?cluster=devnet">
        Просмотрите детали транзакции в Solana Explorer
      </Card>
    </CardGroup>
    <UndelegateCode />

    [⬆️ Вернуться к началу](#code-snippets)
  </Tab>
</Tabs>

---

### Расширенные Фрагменты Кода

<Tabs>
  <Tab title="Изменить размер PDA">
    **При изменении размера делегированного PDA:**

    - **PDA должен иметь достаточно лампортов**, чтобы оставаться освобождённым от арендной платы для нового размера аккаунта.
    - **Если требуется добавить дополнительные лампорты**, счётчик-плательщик должен быть делегирован для предоставления недостающей суммы.
    - **PDA должен принадлежать программе**, а транзакция должна включать всех необходимых подписантов для перевода лампортов.
    - \*\*Используйте \*\*`system_instruction::allocate`

    <ResizeCode />

    [⬆️ Вернуться к началу](#advanced-code-snippets)
  </Tab>
  <Tab title="Делегирование на кривой">
    <OncurveDelegation />

    [⬆️ Вернуться к началу](#advanced-code-snippets)
  </Tab>
</Tabs>

---

import Endpoints from "/snippets/endpoints.mdx";
import Validators from "/snippets/validators.mdx";
import SoftwareRust from "/snippets/software-rust.mdx";
import SolanaResources from "/snippets/solana-resources.mdx";

### **Solana Explorer**

Получайте информацию о ваших транзакциях и аккаунтах в сети Solana:

<Columns cols={2}>
  <Card title="Solana Explorer" icon="search" iconType="duotone" href="https://explorer.solana.com/">
    Официальный обозреватель Solana
  </Card>
  <Card title="Solscan" icon="search" iconType="sharp-solid" href="https://solscan.io/">
    Обозреватель блокчейна Solana
  </Card>
</Columns>

### **Провайдеры Solana RPC**

Отправляйте транзакции и запросы через существующих RPC-провайдеров:

<Columns cols={2}>
  <Card title="Solana" icon="star" iconType="sharp-solid" href="https://solana.com/docs/references/clusters#on-a-high-level">
    Бесплатные публичные ноды
  </Card>
  <Card title="Helius" icon="star-of-life" href="https://www.helius.dev/solana-rpc-nodes">
    Бесплатные общие ноды
  </Card>
  <Card title="Triton" icon="wand-magic-sparkles" href="https://triton.one/solana">
    Выделенные высокопроизводительные ноды
  </Card>
</Columns>

### **Панель валидаторов Solana**

Следите за обновлениями инфраструктуры валидаторов Solana в реальном времени:

<Columns cols={2}>
  <Card title="Solana Beach" icon="umbrella-beach" iconType="duotone" href="https://solanabeach.io/">
    Аналитика по валидаторам
  </Card>
  <Card title="Validators App" icon="cloud-arrow-down" iconType="duotone" href="https://www.validators.app/">
    Метрики валидаторов
  </Card>
</Columns>

### **Статус серверов**

Подпишитесь на обновления статуса серверов Solana и MagicBlock:

<Columns cols={2}>
  <Card title="Solana Status" icon="server" href="https://status.solana.com/">
    Подписка на обновления статуса серверов Solana
  </Card>
  <Card title="MagicBlock Status" icon="heart-pulse" iconType="duotone" href="/pages/overview/additional-information/server-status">
    Подписка на статус серверов MagicBlock
  </Card>
</Columns>

---